(WooInvoicePayment=WooInvoicePayment||{}).Checkout=function(){var n=this,c=jQuery;return n.doing_ajax=!1,n.selectors={paymentMethodRadio:'input[name="payment_method"]',shippingMethodSelect:'select[name="woocommerce_invoice_payment_shipping_choice"]'},n.bindEvents=function(){c(document).ready(function(){"1"===woocommerce_invoice_payment.hide_billing_fields&&(n.toggleBillingTerms(),setTimeout(function(){n.updateSessionPaymentMethod()},50))}),c(document.body).on("payment_method_selected",function(){n.toggleBillingTerms(),setTimeout(function(){n.updateSessionPaymentMethod()},50)}),c(document.body).on("updated_checkout",function(){n.toggleLocalPickup()}),c(document).on("change",n.selectors.shippingMethodSelect,function(){setTimeout(function(){n.updateSessionPaymentMethod()},50)}),c(document).on("change",n.selectors.paymentMethodRadio,function(){n.toggleBillingTerms(),setTimeout(function(){n.updateSessionPaymentMethod(),c(document.body).trigger("update_checkout")},50)}),c(document.body).on("checkout_error",function(){n.validateShippingMethod()}),c(document).on("change",n.selectors.shippingMethodSelect,function(){n.validateShippingMethod(),n.toggleLocalPickup()})},n.toggleTaxSubtotal=function(){var e=c(n.selectors.paymentMethodRadio+":checked").val();void 0!==e&&""!==e&&("invoice"==e&&woocommerce_invoice_payment.hide_tax_subtotal?(c(".tax-total").hide(),c(".tax-rate").hide()):(c(".tax-total").show(),c(".tax-rate").show()))},n.toggleBillingTerms=function(){var e;"1"!==woocommerce_invoice_payment.hide_billing_fields?n.toggleBillingFields(!1):void 0!==(e=c(n.selectors.paymentMethodRadio+":checked").val())&&""!==e&&("invoice"!==e?n.toggleBillingFields(!1):n.toggleBillingFields(!0))},n.toggleBodyClass=function(){"invoice"==c(n.selectors.paymentMethodRadio+":checked").val()?c("body").addClass("has-invoice-payment-method"):c("body").removeClass("has-invoice-payment-method")},n.updateSessionPaymentMethod=function(){n.doing_ajax=!0;var e,o=c(n.selectors.paymentMethodRadio+":checked").val();void 0!==o&&""!==o&&(e=c(n.selectors.shippingMethodSelect).val(),c.ajax({url:woocommerce_invoice_payment.ajaxurl,type:"post",datatype:"json",data:{action:"update_session_payment_method",nonce:woocommerce_invoice_payment.nonce,payment_method:o,shipping_method:e},success:function(e){n.doing_ajax=!1,"1"===woocommerce_invoice_payment.hide_billing_fields&&(c(n.selectors.paymentMethodRadio+":checked").val(),"invoice"!==e.data.new_payment_method&&e.data.billing_fields,n.populateBillingFields(e.data.billing_fields),n.toggleBillingFields(e.data.hide_billing),n.toggleTaxSubtotal(),n.toggleBodyClass(),n.toggleShippingFields(),setTimeout(function(){c(document.body).trigger("country_to_state_changed"),c(document.body).trigger("update_checkout")},500))},error:function(e){console.log(e)}}))},n.populateBillingFields=function(e){c(".woocommerce-billing-fields__field-wrapper").html(e)},n.toggleBillingFields=function(e){var o=c(".woocommerce-billing-fields").find(".form-row, .address-book-selection").not("#billing_first_name_field").not("#billing_last_name_field").not("#billing_email_field"),i=c("#ship-to-different-address");e?(c(".woocommerce-checkout").addClass("billing-fields-hidden"),c(o).hide(),c(i).hide()):(c(".woocommerce-checkout").removeClass("billing-fields-hidden"),c(o).show(),c(i).show()),c(document).trigger("woocommerce-invoice-payment-billing-fields-toggled",[e])},n.validateShippingMethod=function(){var e=c(n.selectors.shippingMethodSelect),o=c(e).parents("tr"),i=c(e).parents(".form-row");""==c(e).val()||0==c(e).val()?(c(o).addClass("has-error"),c(i).addClass("woocommerce-invalid-required-field")):(c(o).removeClass("has-error"),c(i).removeClass("woocommerce-invalid-required-field"))},n.invoicePaymentSelected=function(){return"invoice"===c(n.selectors.paymentMethodRadio+":checked").val()},n.localPickupSelected=function(){var e=c(n.selectors.shippingMethodSelect).val();return!(void 0===e||!e.includes("_local_pickup_expanded"))},n.toggleLocalPickup=function(){var e;n.invoicePaymentSelected()&&(e=c(".woocommerce-local-pickup-expanded-checkout"),n.localPickupSelected()?c(e).show():c(e).hide())},n.toggleShippingFields=function(){var e=!!n.localPickupSelected(),o=c('select[name="woocommerce_invoice_payment_shipping_choice"]'),i=c(".shipping_address"),o=(n.invoicePaymentSelected()||(e=!1),(1<c("select.shipping_method").length?c("select.shipping_method").find("option"):c("input.shipping_method")).length<2&&(e=!1),0<o.length&&c('select[name="woocommerce_invoice_payment_shipping_choice"] option:checked').val().includes("_local_pickup_expanded")&&(e=!0),0<c(".address-book-selection").length&&(i=c(".shipping_address").find(".form-row, .address-book-selection")),c(".woocommerce-shipping-fields").find("h3")),t=c("#ship-to-different-address");e?(c("body").addClass("shipping-fields-hidden"),c(".woocommerce-shipping-fields .address-book-selection").hide(),c(i).hide(),c(o).hide(),c(t).hide(),c("#ship-to-different-address-checkbox").removeAttr("checked")):(c("body").removeClass("shipping-fields-hidden"),c(".woocommerce-shipping-fields .address-book-selection").show(),c(t).show(),c(i).show(),c(o).show())},n.bindEvents()};var WooInvoicePayment=WooInvoicePayment||{};jQuery(document).ready(function(){new WooInvoicePayment.Factory}),WooInvoicePayment.Factory=function(){jQuery;return this.build=function(){new WooInvoicePayment.Checkout},this.build()};