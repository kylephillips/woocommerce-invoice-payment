(WooInvoicePayment=WooInvoicePayment||{}).Checkout=function(){var t=this,l=jQuery;return t.doing_ajax=!1,t.selectors={paymentMethodRadio:'input[name="payment_method"]',shippingMethodSelect:'select[name="woocommerce_invoice_payment_shipping_choice"]'},t.bindEvents=function(){l(document).ready(function(){"1"===woocommerce_invoice_payment.hide_billing_fields&&(t.toggleBillingTerms(),setTimeout(function(){t.updateSessionPaymentMethod()},50))}),l(document.body).on("payment_method_selected",function(){t.toggleBillingTerms(),setTimeout(function(){t.updateSessionPaymentMethod()},50)}),l(document.body).on("updated_checkout",function(){t.toggleLocalPickup(),t.toggleTaxSubtotal(),t.toggleBodyClass()}),l(document).on("change",t.selectors.shippingMethodSelect,function(){setTimeout(function(){t.updateSessionPaymentMethod()},50)}),l(document).on("change",t.selectors.paymentMethodRadio,function(){t.toggleBillingTerms(),setTimeout(function(){t.updateSessionPaymentMethod(),l(document.body).trigger("update_checkout")},50)}),l(document.body).on("checkout_error",function(){t.validateShippingMethod()}),l(document).on("change",t.selectors.shippingMethodSelect,function(){t.validateShippingMethod(),t.toggleLocalPickup()})},t.toggleTaxSubtotal=function(){var e=l(t.selectors.paymentMethodRadio+":checked").val();void 0!==e&&""!==e&&("invoice"==e&&woocommerce_invoice_payment.hide_tax_subtotal?(l(".tax-total").hide(),l(".tax-rate").hide()):(l(".tax-total").show(),l(".tax-rate").show()))},t.toggleBillingTerms=function(){var e;"1"!==woocommerce_invoice_payment.hide_billing_fields?t.toggleBillingFields(!1):void 0!==(e=l(t.selectors.paymentMethodRadio+":checked").val())&&""!==e&&("invoice"!==e?t.toggleBillingFields(!1):t.toggleBillingFields(!0))},t.toggleBodyClass=function(){"invoice"==l(t.selectors.paymentMethodRadio+":checked").val()?l("body").addClass("has-invoice-payment-method"):l("body").removeClass("has-invoice-payment-method")},t.updateSessionPaymentMethod=function(){t.doing_ajax=!0;var e,o=l(t.selectors.paymentMethodRadio+":checked").val();void 0!==o&&""!==o&&(e=l(t.selectors.shippingMethodSelect).val(),l.ajax({url:woocommerce_invoice_payment.ajaxurl,type:"post",datatype:"json",data:{action:"update_session_payment_method",nonce:woocommerce_invoice_payment.nonce,payment_method:o,shipping_method:e},success:function(e){t.doing_ajax=!1,"1"===woocommerce_invoice_payment.hide_billing_fields&&(l(t.selectors.paymentMethodRadio+":checked").val(),"invoice"!==e.data.new_payment_method&&e.data.billing_fields,t.populateBillingFields(e.data.billing_fields),t.overrideBillingDetails(e.data.customer_details,e.data.customer_fields_custom_force),t.populateShippingFields(e.data.shipping_fields),t.toggleBillingFields(e.data.hide_billing),setTimeout(function(){l(document.body).trigger("country_to_state_changed"),l(document.body).trigger("update_checkout")},500))},error:function(e){console.log(e)}}))},t.populateBillingFields=function(e){l(".woocommerce-billing-fields__field-wrapper").html(e)},t.overrideBillingDetails=function(e,o){for(var i in o){var t="billing_"+i;o[i]?l("#"+t).attr("disabled",!0):l("#"+t).removeAttr("disabled")}for(var n in e){t="billing_"+n;e[n]&&l("#"+t).val(e[n])}},t.populateShippingFields=function(e){e&&l(".woocommerce-shipping-fields__field-wrapper").html(e)},t.toggleBillingFields=function(e){var o=l(".woocommerce-billing-fields").find(".form-row, .address-book-selection").not("#billing_first_name_field").not("#billing_last_name_field").not("#billing_email_field").not("#billing_company_field"),i=l("#ship-to-different-address");e?(l(".woocommerce-checkout").addClass("billing-fields-hidden"),l(o).hide(),l(i).hide()):(l(".woocommerce-checkout").removeClass("billing-fields-hidden"),l(o).show(),l(i).show()),l(document).trigger("woocommerce-invoice-payment-billing-fields-toggled",[e])},t.validateShippingMethod=function(){var e=l(t.selectors.shippingMethodSelect),o=l(e).parents("tr"),i=l(e).parents(".form-row");""==l(e).val()||0==l(e).val()?(l(o).addClass("has-error"),l(i).addClass("woocommerce-invalid-required-field")):(l(o).removeClass("has-error"),l(i).removeClass("woocommerce-invalid-required-field"))},t.invoicePaymentSelected=function(){return"invoice"===l(t.selectors.paymentMethodRadio+":checked").val()},t.localPickupSelected=function(){var e=l(t.selectors.shippingMethodSelect).val();return!(void 0===e||!e.includes("_local_pickup_expanded"))},t.toggleLocalPickup=function(){var e;t.invoicePaymentSelected()&&(e=l(".woocommerce-local-pickup-expanded-checkout"),t.localPickupSelected()?l(e).show():l(e).hide())},t.bindEvents()};var WooInvoicePayment=WooInvoicePayment||{};jQuery(document).ready(function(){new WooInvoicePayment.Factory}),WooInvoicePayment.Factory=function(){jQuery;return this.build=function(){new WooInvoicePayment.Checkout},this.build()};